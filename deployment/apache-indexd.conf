<VirtualHost *:80>
    WSGIDaemonProcess indexd processes=1 threads=3 python-path=/var/www/indexd/:/usr/bin/python home=/var/www/indexd
    WSGIScriptAlias / /var/www/indexd/wsgi.py
    WSGIPassAuthorization On
    DocumentRoot /var/www/indexd/
    <Directory "/var/www/indexd/">
        Header set Access-Control-Allow-Origin "*"
        WSGIApplicationGroup %{GLOBAL}
        Options +ExecCGI
        Order deny,allow
        Allow from all
    </Directory>
    ErrorLog ${APACHE_LOG_DIR}/error.log
    LogLevel warn
    LogFormat "%{X-Forwarded-For}i %l %{X-UserId}i %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" aws
    LogFormat "{\"gen3log\": \"apache2\", \"date_access\": \"%t\", \"user_id\": \"%{X-UserId}i\", \"request_id\": \"%{X-ReqId}i\", \"session_id\": \"%{X-SessionId}i\", \"visitor_id\": \"%{X-VisitorId}i\", \"network_client_ip\": \"%{X-Forwarded-For}i\", \"network_bytes_write\": \"%b\", \"http_response_time\": \"%T\", \"http_status_code\": \"%>s\", \"http_request\": \"%U\", \"http_verb\": \"%m\", \"http_referer\": \"%{Referer}i\", \"http_useragent\": \"%{User-agent}i\", \"message\": \"%r\"}" json
    SetEnvIf Host ".*" local
    SetEnvIf X-Forwarded-For "^..*" forwarded
    SetEnvIf Request_URI "^/_status$" !forwarded !local
    CustomLog ${APACHE_LOG_DIR}/access.log json
</VirtualHost>
